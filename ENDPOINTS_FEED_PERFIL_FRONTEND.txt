üì± ENDPOINTS DE FEED Y PERFIL - GU√çA COMPLETA PARA FRONTEND
================================================================

üéØ ENDPOINTS DISPONIBLES

1. GET /api/feed - Obtener feed de recetas
2. GET /api/perfil - Obtener perfil del usuario autenticado
3. PUT /api/perfil - Actualizar perfil del usuario autenticado

‚ö†Ô∏è NOTA: NO HAY FUNCIONALIDAD DE SEGUIR/DEJAR DE SEGUIR USUARIOS IMPLEMENTADA

================================================================

üì± 1. OBTENER FEED DE RECETAS
==============================

ENDPOINT: GET /api/feed

üîê AUTENTICACI√ìN
- Requerida: S√≠
- Tipo: Bearer Token
- Header: Authorization: Bearer {token}

üìã PAR√ÅMETROS DE QUERY (REQUERIDOS)
- usuario_id: number - ID del usuario que solicita el feed

üì§ REQUEST EXAMPLE

const obtenerFeed = async (usuarioId) => {
  try {
    const response = await fetch(`/api/feed?usuario_id=${usuarioId}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    if (response.ok) {
      const data = await response.json();
      console.log('Feed de recetas:', data.data);
    } else {
      const error = await response.json();
      console.error('Error:', error);
    }
  } catch (error) {
    console.error('Error:', error);
  }
};

‚úÖ RESPONSE SUCCESS (200)

{
  "data": [
    {
      "id": 25,
      "titulo": "Tortilla Espa√±ola Cl√°sica",
      "descripcion": "La aut√©ntica tortilla de patatas espa√±ola",
      "dificultad": "Intermedio",
      "foto_principal": "http://localhost/api/images/posts/25.jpg",
      "fecha_creacion": "2025-01-15 10:30:00",
      "nombre_usuario": "chef_juan",
      "foto_perfil": "http://localhost/api/images/profiles/1.jpg",
      "total_favoritos": 15,
      "etiquetas": [
        {
          "nombre": "Sin Gluten",
          "color": "#ffc107"
        },
        {
          "nombre": "Vegetariano",
          "color": "#28a745"
        }
      ]
    }
  ]
}

‚ùå C√ìDIGOS DE ERROR

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 400 | El usuario_id es requerido |
| 565 | No existe un usuario con el ID proporcionado |
| 401 | No autorizado (token inv√°lido) |

================================================================

üë§ 2. OBTENER PERFIL DEL USUARIO
=================================

ENDPOINT: GET /api/perfil

üîê AUTENTICACI√ìN
- Requerida: S√≠
- Tipo: Bearer Token
- Header: Authorization: Bearer {token}

üì§ REQUEST EXAMPLE

const obtenerPerfil = async () => {
  try {
    const response = await fetch('/api/perfil', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    if (response.ok) {
      const data = await response.json();
      console.log('Perfil del usuario:', data.data);
    } else {
      const error = await response.json();
      console.error('Error:', error);
    }
  } catch (error) {
    console.error('Error:', error);
  }
};

‚úÖ RESPONSE SUCCESS (200)

{
  "data": {
    "id": 1,
    "nombre_usuario": "chef_juan",
    "nombre_completo": "Juan Garc√≠a",
    "email": "juan@email.com",
    "bio": "Chef apasionado por la cocina espa√±ola",
    "foto_perfil": "http://localhost/api/images/profiles/1.jpg",
    "fecha_registro": "2025-01-01 12:00:00"
  }
}

‚ùå C√ìDIGOS DE ERROR

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 401 | Usuario no autenticado |
| 404 | Perfil de usuario no encontrado |

================================================================

‚úèÔ∏è 3. ACTUALIZAR PERFIL DEL USUARIO
====================================

ENDPOINT: PUT /api/perfil

üîê AUTENTICACI√ìN
- Requerida: S√≠
- Tipo: Bearer Token
- Header: Authorization: Bearer {token}

üìã CAMPOS OPCIONALES

{
  "nombre_usuario": "string (opcional)",
  "nombre_completo": "string (opcional)",
  "email": "string (opcional)",
  "bio": "string (opcional)",
  "foto_perfil": "string (opcional) - base64",
  "password_actual": "string (opcional) - requerido si se cambia contrase√±a",
  "password_nuevo": "string (opcional) - requerido si se cambia contrase√±a",
  "password_confirmar": "string (opcional) - requerido si se cambia contrase√±a"
}

üì§ REQUEST EXAMPLE

const actualizarPerfil = async (datosPerfil) => {
  try {
    const response = await fetch('/api/perfil', {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        nombre_usuario: "nuevo_usuario",
        nombre_completo: "Nuevo Nombre Completo",
        email: "nuevo@email.com",
        bio: "Mi nueva biograf√≠a",
        foto_perfil: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD..."
      })
    });

    if (response.ok) {
      const data = await response.json();
      console.log('Perfil actualizado:', data);
    } else {
      const error = await response.json();
      console.error('Error:', error);
    }
  } catch (error) {
    console.error('Error:', error);
  }
};

‚úÖ RESPONSE SUCCESS (200)

{
  "message": "Perfil actualizado exitosamente",
  "data": {
    "id": 1,
    "nombre_usuario": "nuevo_usuario",
    "nombre_completo": "Nuevo Nombre Completo",
    "email": "nuevo@email.com",
    "bio": "Mi nueva biograf√≠a",
    "foto_perfil": "http://localhost/api/images/profiles/1.jpg",
    "fecha_registro": "2025-01-01 12:00:00"
  }
}

‚ùå C√ìDIGOS DE ERROR

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 400 | Para cambiar la contrase√±a debes proporcionar: contrase√±a actual, nueva contrase√±a y confirmaci√≥n |
| 400 | La contrase√±a actual es incorrecta |
| 400 | La nueva contrase√±a y su confirmaci√≥n no coinciden |
| 400 | La nueva contrase√±a debe tener al menos 6 caracteres |
| 400 | El nombre de usuario ya est√° en uso |
| 400 | El email ya est√° en uso |
| 401 | Usuario no autenticado |

================================================================

‚ö†Ô∏è FUNCIONALIDAD DE SEGUIR USUARIOS
====================================

üö´ NO IMPLEMENTADA

Actualmente NO existe funcionalidad para:
- Seguir usuarios
- Dejar de seguir usuarios
- Ver lista de seguidores
- Ver lista de usuarios seguidos
- Feed personalizado basado en usuarios seguidos

El feed actual muestra TODAS las recetas de TODOS los usuarios (excepto las del usuario logueado).

================================================================

üí° RECOMENDACIONES PARA EL FRONTEND

FLUJO DE IMPLEMENTACI√ìN:

1. FEED DE RECETAS:
   - Cargar al iniciar la aplicaci√≥n
   - Mostrar recetas en formato de cards
   - Incluir informaci√≥n del autor (nombre, foto)
   - Mostrar etiquetas con colores
   - Implementar paginaci√≥n si es necesario

2. PERFIL DE USUARIO:
   - Mostrar informaci√≥n completa del usuario
   - Bot√≥n "Editar perfil" para el propio usuario
   - Formulario de edici√≥n con validaciones
   - Preview de imagen antes de subir

3. ACTUALIZACI√ìN DE PERFIL:
   - Formulario con campos opcionales
   - Validaci√≥n de contrase√±a si se cambia
   - Confirmaci√≥n de contrase√±a nueva
   - Procesamiento de imagen base64

EJEMPLO DE IMPLEMENTACI√ìN:

```javascript
// Componente de Feed
const Feed = () => {
  const [recetas, setRecetas] = useState([]);
  const [loading, setLoading] = useState(true);
  const usuarioId = getUsuarioIdFromToken(); // Funci√≥n para obtener ID del token

  useEffect(() => {
    cargarFeed();
  }, []);

  const cargarFeed = async () => {
    try {
      setLoading(true);
      const response = await fetch(`/api/feed?usuario_id=${usuarioId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        setRecetas(data.data);
      }
    } catch (error) {
      console.error('Error al cargar feed:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="feed">
      {loading ? (
        <div>Cargando recetas...</div>
      ) : (
        recetas.map(receta => (
          <RecetaCard key={receta.id} receta={receta} />
        ))
      )}
    </div>
  );
};

// Componente de Perfil
const Perfil = () => {
  const [perfil, setPerfil] = useState(null);
  const [editando, setEditando] = useState(false);

  useEffect(() => {
    cargarPerfil();
  }, []);

  const cargarPerfil = async () => {
    try {
      const response = await fetch('/api/perfil', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const data = await response.json();
        setPerfil(data.data);
      }
    } catch (error) {
      console.error('Error al cargar perfil:', error);
    }
  };

  const actualizarPerfil = async (datosNuevos) => {
    try {
      const response = await fetch('/api/perfil', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(datosNuevos)
      });

      if (response.ok) {
        const data = await response.json();
        setPerfil(data.data);
        setEditando(false);
        alert('Perfil actualizado exitosamente');
      }
    } catch (error) {
      console.error('Error al actualizar perfil:', error);
    }
  };

  return (
    <div className="perfil">
      {perfil && (
        <>
          <img src={perfil.foto_perfil} alt="Foto de perfil" />
          <h2>{perfil.nombre_usuario}</h2>
          <p>{perfil.nombre_completo}</p>
          <p>{perfil.bio}</p>
          
          <button onClick={() => setEditando(true)}>
            ‚úèÔ∏è Editar Perfil
          </button>

          {editando && (
            <FormularioEditarPerfil 
              perfil={perfil} 
              onSave={actualizarPerfil}
              onCancel={() => setEditando(false)}
            />
          )}
        </>
      )}
    </div>
  );
};
```

NOTAS IMPORTANTES:

FEED:
- Excluye las recetas del usuario logueado
- Ordenado por fecha de creaci√≥n (m√°s recientes primero)
- Incluye etiquetas con colores hexadecimales
- URLs de im√°genes procesadas autom√°ticamente
- ‚úÖ NUEVO: Incluye recuento de favoritos (`total_favoritos`)

PERFIL:
- Solo muestra datos del usuario autenticado
- No hay perfil p√∫blico de otros usuarios
- Cambio de contrase√±a requiere validaci√≥n completa
- Imagen de perfil se procesa autom√°ticamente

SEGURIDAD:
- Todos los endpoints requieren autenticaci√≥n
- Validaci√≥n de datos en frontend y backend
- Manejo de errores de token expirado

UI/UX:
- Loading states para mejor experiencia
- Validaci√≥n en tiempo real
- Mensajes de confirmaci√≥n
- Preview de im√°genes antes de subir

================================================================

üÜï NUEVO CAMPO: TOTAL_FAVORITOS
================================

üìä DESCRIPCI√ìN
El campo `total_favoritos` indica cu√°ntos usuarios han marcado la receta como favorita.

üìã CARACTER√çSTICAS
- Tipo: number (entero)
- Rango: 0 o mayor
- Actualizaci√≥n: Tiempo real en cada consulta
- C√°lculo: Subconsulta SQL autom√°tica

üí° EJEMPLOS DE USO EN EL FRONTEND

1. MOSTRAR CONTADOR DE FAVORITOS:
```javascript
const RecetaCard = ({ receta }) => {
  return (
    <div className="receta-card">
      <img src={receta.foto_principal} alt={receta.titulo} />
      <h3>{receta.titulo}</h3>
      <p>{receta.descripcion}</p>
      
      <div className="receta-stats">
        <span className="favoritos">
          ‚ù§Ô∏è {receta.total_favoritos} favoritos
        </span>
        <span className="dificultad">
          {receta.dificultad}
        </span>
      </div>
      
      <div className="etiquetas">
        {receta.etiquetas.map(etiqueta => (
          <span 
            key={etiqueta.nombre}
            className="etiqueta"
            style={{ backgroundColor: etiqueta.color }}
          >
            {etiqueta.nombre}
          </span>
        ))}
      </div>
    </div>
  );
};
```

2. ORDENAR POR POPULARIDAD:
```javascript
const ordenarPorFavoritos = (recetas) => {
  return recetas.sort((a, b) => b.total_favoritos - a.total_favoritos);
};

// Usar en componente
const [orden, setOrden] = useState('fecha');

const recetasOrdenadas = orden === 'favoritos' 
  ? ordenarPorFavoritos(recetas)
  : recetas;
```

3. FILTRAR RECETAS POPULARES:
```javascript
const filtrarRecetasPopulares = (recetas, minFavoritos = 10) => {
  return recetas.filter(receta => receta.total_favoritos >= minFavoritos);
};

// Mostrar solo recetas con m√°s de 15 favoritos
const recetasPopulares = filtrarRecetasPopulares(recetas, 15);
```

4. BADGES DE POPULARIDAD:
```javascript
const getBadgePopularidad = (totalFavoritos) => {
  if (totalFavoritos >= 50) return { texto: 'üî• Viral', color: '#ff4757' };
  if (totalFavoritos >= 20) return { texto: '‚≠ê Popular', color: '#ffa502' };
  if (totalFavoritos >= 10) return { texto: 'üëç Trending', color: '#2ed573' };
  return null;
};

const RecetaCard = ({ receta }) => {
  const badge = getBadgePopularidad(receta.total_favoritos);
  
  return (
    <div className="receta-card">
      {badge && (
        <div className="badge" style={{ backgroundColor: badge.color }}>
          {badge.texto}
        </div>
      )}
      {/* Resto del contenido */}
    </div>
  );
};
```

5. ESTAD√çSTICAS DEL FEED:
```javascript
const obtenerEstadisticasFeed = (recetas) => {
  const totalFavoritos = recetas.reduce((sum, receta) => sum + receta.total_favoritos, 0);
  const promedioFavoritos = totalFavoritos / recetas.length;
  const recetaMasPopular = recetas.reduce((max, receta) => 
    receta.total_favoritos > max.total_favoritos ? receta : max
  );
  
  return {
    totalFavoritos,
    promedioFavoritos: Math.round(promedioFavoritos * 10) / 10,
    recetaMasPopular
  };
};
```

üé® SUGERENCIAS DE DISE√ëO

1. ICONOS Y COLORES:
- ‚ù§Ô∏è Coraz√≥n rojo para favoritos
- üî• Fuego para recetas virales
- ‚≠ê Estrella para recetas populares
- üëç Pulgar arriba para trending

2. ANIMACIONES:
- Contador animado al cargar
- Efecto hover en el icono de favoritos
- Transici√≥n suave al cambiar orden

3. RESPONSIVE:
- Mostrar solo n√∫mero en m√≥viles
- Icono + n√∫mero en tablets
- Texto completo en desktop

‚ö†Ô∏è CONSIDERACIONES T√âCNICAS

1. RENDIMIENTO:
- El recuento se calcula en tiempo real
- Considerar cach√© en frontend para mejor UX
- Implementar paginaci√≥n para feeds grandes

2. ACTUALIZACI√ìN:
- El n√∫mero puede cambiar entre consultas
- Considerar actualizaci√≥n autom√°tica cada X minutos
- Mostrar indicador de "actualizado hace X tiempo"

3. VALIDACI√ìN:
- Siempre verificar que `total_favoritos` existe
- Manejar casos donde el valor es null o undefined
- Mostrar "0" en lugar de valores vac√≠os 